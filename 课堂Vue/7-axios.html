<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Document</title>
  </head>
  <script src="./vue.js"></script>
  <script src="./axios.js"></script>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
    .edit-box-page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(198, 191, 206, 0.397);
    }
    .edit-box {
      width: 400px;
      height: 210px;
      background-color: #ffffff;
      position: relative;
      left: 35%;
      top: 30%;
      text-align: center;
    }
    .edit-box input,
    .edit-box select {
      width: 300px;
      height: 20px;
      margin-bottom: 20px;
      border: 1px solid rgb(114, 109, 109);
      border-radius: 5px;
    }
    .edit-box button {
      float: right;
      width: 70px;
      height: 30px;
      line-height: 30px;
      margin-right: 5px;
      border: none;
      border-radius: 3px;
      background-color: seagreen;
      cursor: pointer;
      color: white;
    }
  </style>
  <body>
    <div id="app">
      <h1>学生信息</h1>
      <div>
        姓名:<input type="text" name="name" v-model="name" /> 性别:<select
          name="sex"
          v-model="sex"
        >
          <option value="male">男</option>
          <option value="male">女</option>
        </select>
        年龄:<input type="text" v-model="age" />
        <button @click="add">添加</button>
      </div>
      <ul>
        <li v-for="student in students">
          name:{{student.name}} -id:{{student.id}} -sex:{{student.sex}}
          -age:{{student.age}}
          <button @click="del(student.id)">删除</button>
          <button @click="edit(student)">编辑</button>
        </li>
      </ul>

      <div class="edit-box-page" v-show="editbox">
        <div class="edit-box" id="editDialog">
          <h3>用户修改</h3>
          姓名:<input type="text" name="name" v-model="editItem.name" /> <br />
          性别:<select name="sex" v-model="editItem.sex">
            <option value="male">男</option>
            <option value="male">女</option>
          </select>
          <br />
          年龄:<input type="text" v-model="editItem.age" /> <br />
          <button @click="editTrue()">修改</button>
        </div>
      </div>
    </div>
  </body>
  <script>
    let app = new Vue({
      data() {
        return {
          students: null,
          name: '',
          age: 0,
          sex: '',
          editbox: false,
          editItem: {
            id: '',
            name: '',
            age: 0,
            sex: ''
          }
        };
      },

      methods: {
        query: function() {
          axios
            .get('http://47.101.161.91/students')
            .then((res) => {
              console.log(res.data);
              this.students = res.data;
            })
            .catch((err) => {
              console.error(err);
            });
        },
        add: function() {
          let newStu = { name: this.name, age: this.age, sex: this.sex };
          axios
            .post('http://47.101.161.91/students', newStu)
            .then((res) => {
              console.log(res.data);
              this.query();
            })
            .catch((err) => {
              console.error(err);
            });
        },
        del(id) {
          axios
            .delete('http://47.101.161.91/students', {
              data: {
                id: id
              }
            })
            .then((res) => {
              console.log(res);
              this.query();
            })
            .catch((err) => {
              alert('删除错误');
              console.error(err);
            });
        },
        edit(body) {
          this.editbox = true;
          this.editItem.id = body.id;
          this.editItem.name = body.name;
          this.editItem.sex = body.sex;
          this.editItem.age = body.age;
        },
        editTrue() {
          let result = {
            id: this.editItem.id,
            name: this.editItem.name,
            age: this.editItem.age,
            sex: this.editItem.sex
          };

          axios
            .put('http://47.101.161.91/students', result)
            .then((res) => {
              console.log(result);
              this.editbox = false;
              this.query();
            })
            .catch((err) => {
              alert('删除错误');
              this.query();
              console.error(err);
            });
        }
      },
      created() {
        this.query();
      }
    }).$mount('#app');
  </script>
</html>
